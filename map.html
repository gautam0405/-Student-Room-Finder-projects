<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Room Map - Student Room Finder</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Map Page Specific Styles */
        .map-container {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, #007bff, #00c6ff);
            min-height: 100vh;
        }

        .map-header {
            max-width: 1200px;
            margin: 0 auto 20px;
            text-align: center;
            color: white;
        }

        .map-header h2 {
            font-size: 2rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .search-box-wrapper {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
        }

        .search-box {
            width: 100%;
            max-width: 500px;
            padding: 15px 20px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
        }

        .search-box:focus {
            outline: none;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            transform: translateY(-2px);
        }

        .search-box::placeholder {
            color: #999;
        }

        .search-info {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.95rem;
            font-weight: 500;
        }

        .map-wrapper {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            height: 600px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            background: white;
        }

        #map {
            width: 100%;
            height: 100%;
            border-radius: 15px;
        }

        /* Room Details Panel */
        .room-details-panel {
            position: absolute;
            right: 20px;
            top: 20px;
            width: 320px;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            max-height: 550px;
            overflow-y: auto;
            z-index: 10;
            animation: slideIn 0.3s ease-out;
            display: none;
        }

        .room-details-panel.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .room-details-panel h3 {
            margin: 0 0 15px 0;
            color: #007bff;
            font-size: 1.3rem;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }

        .details-content {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .details-content p {
            margin: 0;
            font-size: 0.95rem;
            color: #333;
            line-height: 1.6;
        }

        .rent-highlight {
            background: rgba(255, 204, 0, 0.1);
            padding: 10px;
            border-radius: 6px;
            border-left: 4px solid #ffcc00;
            font-weight: 600;
            color: #ff8c00;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 11;
        }

        .close-btn:hover {
            background: #ee5a52;
            transform: scale(1.1);
        }

        .legend {
            max-width: 1200px;
            margin: 20px auto 0;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 10px;
            color: white;
            font-weight: 500;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .map-container {
                padding: 15px;
            }

            .map-header h2 {
                font-size: 1.5rem;
            }

            .map-wrapper {
                height: 400px;
            }

            .room-details-panel {
                width: 90%;
                right: 10px;
                left: 10px;
                top: auto;
                bottom: 20px;
                max-height: 300px;
            }

            .search-box {
                font-size: 16px;
            }
        }

        @media (max-width: 500px) {
            .map-header h2 {
                font-size: 1.2rem;
            }

            .map-wrapper {
                height: 300px;
            }

            .room-details-panel {
                width: 95%;
                padding: 15px;
                right: 5px;
                left: 5px;
            }

            .room-details-panel h3 {
                font-size: 1.1rem;
            }

            .search-box {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <header class="navbar">
        <div class="logo">üè† Student Room Finder</div>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li id="userInfoNav" style="display:none;"><span id="userNameSpan"></span></li>
                <li id="logoutNav" style="display:none;"><a onclick="logout()" class="logout-btn">Logout</a></li>
            </ul>
        </nav>
    </header>

    <div class="map-container">
        <div class="map-header">
            <h2>üó∫Ô∏è Room Locations Map</h2>
            <div class="search-box-wrapper">
                <input
                    type="text"
                    class="search-box"
                    id="searchInput"
                    placeholder="Search by location or address..."
                />
                <span class="search-info">
                    <span id="roomCount">0</span> room<span id="roomLabel">s</span> found
                </span>
            </div>
        </div>

        <div class="map-wrapper">
            <div id="map"></div>

            <div class="room-details-panel" id="roomDetailsPanel">
                <button class="close-btn" onclick="closePanel()">‚úï</button>
                <h3 id="panelTitle">üìç Location</h3>
                <div class="details-content" id="detailsContent">
                    <!-- Dynamic content will be added here -->
                </div>
            </div>
        </div>

        <div class="legend">
            <p>üî¥ Red markers = Room locations ‚Ä¢ Click on any marker to see details</p>
        </div>
    </div>

    <!-- Google Maps API -->
    <!-- IMPORTANT: Replace YOUR_API_KEY with your actual Google Maps API key -->
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY"></script>

    <script>
        let map;
        let markers = [];
        let allRooms = [];
        let filteredRooms = [];
        let currentSelectedRoom = null;

        // Initialize map on page load
        function initMap() {
            // Default location (Delhi)
            const defaultLocation = { lat: 28.7041, lng: 77.1025 };

            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 12,
                center: defaultLocation,
                styles: [
                    {
                        featureType: 'all',
                        elementType: 'labels.text.fill',
                        stylers: [{ color: '#333333' }]
                    }
                ]
            });

            // Load rooms from localStorage
            loadAndDisplayRooms();
            
            // Update navbar
            updateNavbar();
        }

        function loadAndDisplayRooms() {
            const savedPosts = JSON.parse(localStorage.getItem('posts')) || [];
            // Filter only approved posts
            allRooms = savedPosts.filter(post => post.status === 'approved');
            filteredRooms = allRooms;

            addMarkers(allRooms);
            updateRoomCount();
        }

        function addMarkers(roomsToMark) {
            // Clear existing markers
            markers.forEach(marker => marker.setMap(null));
            markers = [];

            // Location coordinates mapping
            const locationCoordinates = {
                'delhi': { lat: 28.7041, lng: 77.1025 },
                'mumbai': { lat: 19.0760, lng: 72.8777 },
                'bangalore': { lat: 12.9716, lng: 77.5946 },
                'pune': { lat: 18.5204, lng: 73.8567 },
                'hyderabad': { lat: 17.3850, lng: 78.4867 },
                'chennai': { lat: 13.0827, lng: 80.2707 }
            };

            roomsToMark.forEach((room, index) => {
                const coords = locationCoordinates[room.location?.toLowerCase()] ||
                    { lat: 28.7041 + Math.random() * 0.1, lng: 77.1025 + Math.random() * 0.1 };

                const marker = new google.maps.Marker({
                    position: coords,
                    map: map,
                    title: room.location,
                    icon: 'http://maps.google.com/mapfiles/ms/icons/red-dot.png'
                });

                // Info window with room details
                const infoWindow = new google.maps.InfoWindow({
                    content: `
                        <div style="color: #333; padding: 10px; font-family: Poppins, sans-serif;">
                            <h4 style="margin: 0 0 10px 0; color: #007bff;">${room.location}</h4>
                            <p style="margin: 5px 0;"><strong>Address:</strong> ${room.address}</p>
                            <p style="margin: 5px 0;"><strong>Rent:</strong> ‚Çπ${room.rent}/month</p>
                            <p style="margin: 5px 0;"><strong>Type:</strong> ${room.roomType}</p>
                            <button onclick="showRoomDetails(${index})" style="background: #007bff; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; width: 100%; margin-top: 8px; font-weight: 600;">View Details</button>
                        </div>
                    `
                });

                marker.addListener('click', () => {
                    // Close all other info windows
                    markers.forEach(m => {
                        if (m.infoWindow) m.infoWindow.close();
                    });
                    infoWindow.open(map, marker);
                    currentSelectedRoom = room;
                    marker.infoWindow = infoWindow;
                });

                marker.infoWindow = infoWindow;
                markers.push(marker);
            });
        }

        function showRoomDetails(index) {
            const room = filteredRooms[index];
            currentSelectedRoom = room;
            const panel = document.getElementById('roomDetailsPanel');
            const title = document.getElementById('panelTitle');
            const content = document.getElementById('detailsContent');

            title.textContent = 'üìç ' + room.location;

            content.innerHTML = `
                <p><strong>Address:</strong> ${room.address}</p>
                <p><strong>Flat Number:</strong> ${room.flatNumber}</p>
                <p class="rent-highlight"><strong>üí∞ Rent:</strong> ‚Çπ${room.rent}/month</p>
                <p><strong>Type:</strong> ${room.roomType}</p>
                <p><strong>Deposit:</strong> ‚Çπ${room.deposit}</p>
                <p><strong>Available:</strong> ${room.availabilityDate}</p>
                ${room.contact ? `<p><strong>üìû Contact:</strong> ${room.contact}</p>` : ''}
                ${room.description ? `<p><strong>Description:</strong> ${room.description}</p>` : ''}
                ${room.amenities ? `<p><strong>Amenities:</strong> ${room.amenities}</p>` : ''}
                <p><strong>Posted by:</strong> ${room.postedBy}</p>
            `;

            panel.classList.add('active');
        }

        function closePanel() {
            document.getElementById('roomDetailsPanel').classList.remove('active');
            currentSelectedRoom = null;
        }

        function searchRooms() {
            const query = document.getElementById('searchInput').value.toLowerCase();

            if (!query) {
                filteredRooms = allRooms;
                addMarkers(allRooms);
                updateRoomCount();
                return;
            }

            filteredRooms = allRooms.filter(room =>
                room.location.toLowerCase().includes(query) ||
                room.address.toLowerCase().includes(query)
            );

            addMarkers(filteredRooms);
            updateRoomCount();

            // Center map on first result
            if (filteredRooms.length > 0) {
                const locationCoordinates = {
                    'delhi': { lat: 28.7041, lng: 77.1025 },
                    'mumbai': { lat: 19.0760, lng: 72.8777 },
                    'bangalore': { lat: 12.9716, lng: 77.5946 },
                    'pune': { lat: 18.5204, lng: 73.8567 },
                    'hyderabad': { lat: 17.3850, lng: 78.4867 },
                    'chennai': { lat: 13.0827, lng: 80.2707 }
                };
                const coords = locationCoordinates[filteredRooms[0].location?.toLowerCase()] ||
                    { lat: 28.7041, lng: 77.1025 };
                map.setCenter(coords);
                map.setZoom(14);
            }
        }

        function updateRoomCount() {
            const count = filteredRooms.length;
            document.getElementById('roomCount').textContent = count;
            document.getElementById('roomLabel').textContent = count !== 1 ? 's' : '';
        }

        function updateNavbar() {
            const user = JSON.parse(localStorage.getItem('loggedInUser'));
            const userInfoNav = document.getElementById('userInfoNav');
            const logoutNav = document.getElementById('logoutNav');

            if (user) {
                userInfoNav.style.display = 'block';
                logoutNav.style.display = 'block';
                document.getElementById('userNameSpan').textContent = 'üë§ ' + (user.name || user.email);
            }
        }

        function logout() {
            localStorage.removeItem('loggedInUser');
            window.location.href = 'index.html';
        }

        // Event listeners
        document.getElementById('searchInput').addEventListener('input', searchRooms);

        // Initialize map on page load
        window.addEventListener('load', initMap);
    </script>
</body>
</html>
